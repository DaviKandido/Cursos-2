{"version":3,"file":"compiler.mjs","sources":["../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/directive_matching.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/core.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/compiler_facade_interface.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/digest.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/output_ast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/constant_pool.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_identifiers.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/source_map.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/abstract_emitter.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_factory.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/expression_parser/ast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/tags.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_ast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/i18n_ast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/serializer.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/xml_helper.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/xmb.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/i18n/util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/injectable_compiler_2.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/assertions.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/defaults.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/chars.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/parse_util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/abstract_js_emitter.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/output_jit_trusted_types.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/output_jit.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_injector_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_jit.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_module_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_pipe_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/api.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/shadow_css.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/enums.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/traits.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/ops/shared.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/ops/update.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/expression.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/operations.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/handle.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/ops/create.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/ops/host.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/ir/src/variable.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/compilation.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/any_cast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/apply_i18n_expressions.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/assign_i18n_slot_dependencies.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/attach_source_locations.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/util/elements.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/attribute_extraction.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/binding_specialization.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/chaining.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/collapse_singleton_interpolations.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/conditionals.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/conversion.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/const_collection.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/convert_i18n_bindings.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/create_i18n_contexts.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/deduplicate_text_bindings.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/defer_configs.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/defer_resolve_targets.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/empty_elements.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/expand_safe_reads.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/extract_i18n_messages.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/generate_advance.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/generate_local_let_references.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/generate_projection_def.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/generate_variables.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/has_const_expression_collection.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/host_style_property_parsing.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/output/map_util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/i18n/icu_serializer.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/ast.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/entities.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/lexer.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/html_whitespaces.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/expression_parser/lexer.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/expression_parser/parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/expression_parser/serializer.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/schema/dom_security_schema.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/schema/element_schema_registry.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/schema/dom_element_schema_registry.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/html_tags.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/placeholder.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/i18n_parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/parse_util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/schema/trusted_types_sinks.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/i18n/meta.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/i18n/get_msg_utils.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/i18n/localize_utils.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/i18n_const_collection.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/i18n_text_extraction.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/local_refs.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/namespace.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/parse_extracted_styles.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/naming.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/next_context_merging.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/ng_container.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/nonbindable.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/ordering.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/phase_remove_content_selectors.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/pipe_creation.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/pipe_variadic.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/propagate_i18n_blocks.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/pure_function_extraction.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/pure_literal_structures.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/instruction.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/reify.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/remove_empty_bindings.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/remove_i18n_contexts.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/remove_illegal_let_references.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/remove_unused_i18n_attrs.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_contexts.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_defer_deps_fns.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_dollar_event.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_i18n_element_placeholders.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_i18n_expression_placeholders.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_names.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/resolve_sanitizers.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/save_restore_view.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/slot_allocation.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/store_let_optimization.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/strip_nonrequired_parentheses.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/style_binding_specialization.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/temporary_variables.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/track_fn_optimization.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/track_variables.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/transform_two_way_binding_set.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/var_counting.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/variable_optimization.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/phases/wrap_icus.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/emit.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template/pipeline/src/ingest.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/config.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/query_generation.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/html_parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template_parser/binding_parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/style_url_resolver.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/template_parser/template_preparser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_control_flow.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_deferred_triggers.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_deferred_blocks.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_template_transform.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/template.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/view/t2_binder.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/resource_loader.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/jit_compiler_facade.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/config.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/extractor_merger.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/xml_tags.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/ml_parser/xml_parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/xliff.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/xliff2.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/serializers/xtb.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/translation_bundle.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/i18n_html_parser.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/i18n/message_bundle.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_class_metadata_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/class_metadata.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/util.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/directive.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/component.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/factory.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/injectable.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/injector.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/ng_module.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/partial/pipe.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_class_debug_info_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/render3/r3_hmr_compiler.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/version.ts","../../../../../k8-fastbuild-ST-46c76129e412/bin/packages/compiler/src/compiler.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nconst _SELECTOR_REGEXP = new RegExp(\n  '(\\\\:not\\\\()|' + // 1: \":not(\"\n    '(([\\\\.\\\\#]?)[-\\\\w]+)|' + // 2: \"tag\"; 3: \".\"/\"#\";\n    // \"-\" should appear first in the regexp below as FF31 parses \"[.-\\w]\" as a range\n    // 4: attribute; 5: attribute_string; 6: attribute_value\n    '(?:\\\\[([-.\\\\w*\\\\\\\\$]+)(?:=([\"\\']?)([^\\\\]\"\\']*)\\\\5)?\\\\])|' + // \"[name]\", \"[name=value]\",\n    // \"[name=\"value\"]\",\n    // \"[name='value']\"\n    '(\\\\))|' + // 7: \")\"\n    '(\\\\s*,\\\\s*)', // 8: \",\"\n  'g',\n);\n\n/**\n * These offsets should match the match-groups in `_SELECTOR_REGEXP` offsets.\n */\nconst enum SelectorRegexp {\n  ALL = 0, // The whole match\n  NOT = 1,\n  TAG = 2,\n  PREFIX = 3,\n  ATTRIBUTE = 4,\n  ATTRIBUTE_STRING = 5,\n  ATTRIBUTE_VALUE = 6,\n  NOT_END = 7,\n  SEPARATOR = 8,\n}\n/**\n * A css selector contains an element name,\n * css classes and attribute/value pairs with the purpose\n * of selecting subsets out of them.\n */\nexport class CssSelector {\n  element: string | null = null;\n  classNames: string[] = [];\n  /**\n   * The selectors are encoded in pairs where:\n   * - even locations are attribute names\n   * - odd locations are attribute values.\n   *\n   * Example:\n   * Selector: `[key1=value1][key2]` would parse to:\n   * ```\n   * ['key1', 'value1', 'key2', '']\n   * ```\n   */\n  attrs: string[] = [];\n  notSelectors: CssSelector[] = [];\n\n  static parse(selector: string): CssSelector[] {\n    const results: CssSelector[] = [];\n    const _addResult = (res: CssSelector[], cssSel: CssSelector) => {\n      if (\n        cssSel.notSelectors.length > 0 &&\n        !cssSel.element &&\n        cssSel.classNames.length == 0 &&\n        cssSel.attrs.length == 0\n      ) {\n        cssSel.element = '*';\n      }\n      res.push(cssSel);\n    };\n    let cssSelector = new CssSelector();\n    let match: string[] | null;\n    let current = cssSelector;\n    let inNot = false;\n    _SELECTOR_REGEXP.lastIndex = 0;\n    while ((match = _SELECTOR_REGEXP.exec(selector))) {\n      if (match[SelectorRegexp.NOT]) {\n        if (inNot) {\n          throw new Error('Nesting :not in a selector is not allowed');\n        }\n        inNot = true;\n        current = new CssSelector();\n        cssSelector.notSelectors.push(current);\n      }\n      const tag = match[SelectorRegexp.TAG];\n      if (tag) {\n        const prefix = match[SelectorRegexp.PREFIX];\n        if (prefix === '#') {\n          // #hash\n          current.addAttribute('id', tag.slice(1));\n        } else if (prefix === '.') {\n          // Class\n          current.addClassName(tag.slice(1));\n        } else {\n          // Element\n          current.setElement(tag);\n        }\n      }\n      const attribute = match[SelectorRegexp.ATTRIBUTE];\n\n      if (attribute) {\n        current.addAttribute(\n          current.unescapeAttribute(attribute),\n          match[SelectorRegexp.ATTRIBUTE_VALUE],\n        );\n      }\n      if (match[SelectorRegexp.NOT_END]) {\n        inNot = false;\n        current = cssSelector;\n      }\n      if (match[SelectorRegexp.SEPARATOR]) {\n        if (inNot) {\n          throw new Error('Multiple selectors in :not are not supported');\n        }\n        _addResult(results, cssSelector);\n        cssSelector = current = new CssSelector();\n      }\n    }\n    _addResult(results, cssSelector);\n    return results;\n  }\n\n  /**\n   * Unescape `\\$` sequences from the CSS attribute selector.\n   *\n   * This is needed because `$` can have a special meaning in CSS selectors,\n   * but we might want to match an attribute that contains `$`.\n   * [MDN web link for more\n   * info](https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors).\n   * @param attr the attribute to unescape.\n   * @returns the unescaped string.\n   */\n  unescapeAttribute(attr: string): string {\n    let result = '';\n    let escaping = false;\n    for (let i = 0; i < attr.length; i++) {\n      const char = attr.charAt(i);\n      if (char === '\\\\') {\n        escaping = true;\n        continue;\n      }\n      if (char === '$' && !escaping) {\n        throw new Error(\n          `Error in attribute selector \"${attr}\". ` +\n            `Unescaped \"$\" is not supported. Please escape with \"\\\\$\".`,\n        );\n      }\n      escaping = false;\n      result += char;\n    }\n    return result;\n  }\n\n  /**\n   * Escape `$` sequences from the CSS attribute selector.\n   *\n   * This is needed because `$` can have a special meaning in CSS selectors,\n   * with this method we are escaping `$` with `\\$'.\n   * [MDN web link for more\n   * info](https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors).\n   * @param attr the attribute to escape.\n   * @returns the escaped string.\n   */\n  escapeAttribute(attr: string): string {\n    return attr.replace(/\\\\/g, '\\\\\\\\').replace(/\\$/g, '\\\\$');\n  }\n\n  isElementSelector(): boolean {\n    return (\n      this.hasElementSelector() &&\n      this.classNames.length == 0 &&\n      this.attrs.length == 0 &&\n      this.notSelectors.length === 0\n    );\n  }\n\n  hasElementSelector(): boolean {\n    return !!this.element;\n  }\n\n  setElement(element: string | null = null) {\n    this.element = element;\n  }\n\n  getAttrs(): string[] {\n    const result: string[] = [];\n    if (this.classNames.length > 0) {\n      result.push('class', this.classNames.join(' '));\n    }\n    return result.concat(this.attrs);\n  }\n\n  addAttribute(name: string, value: string = '') {\n    this.attrs.push(name, (value && value.toLowerCase()) || '');\n  }\n\n  addClassName(name: string) {\n    this.classNames.push(name.toLowerCase());\n  }\n\n  toString(): string {\n    let res: string = this.element || '';\n    if (this.classNames) {\n      this.classNames.forEach((klass) => (res += `.${klass}`));\n    }\n    if (this.attrs) {\n      for (let i = 0; i < this.attrs.length; i += 2) {\n        const name = this.escapeAttribute(this.attrs[i]);\n        const value = this.attrs[i + 1];\n        res += `[${name}${value ? '=' + value : ''}]`;\n      }\n    }\n    this.notSelectors.forEach((notSelector) => (res += `:not(${notSelector})`));\n    return res;\n  }\n}\n\n/**\n * Reads a list of CssSelectors and allows to calculate which ones\n * are contained in a given CssSelector.\n */\nexport class SelectorMatcher<T = any> {\n  static createNotMatcher(notSelectors: CssSelector[]): SelectorMatcher<null> {\n    const notMatcher = new SelectorMatcher<null>();\n    notMatcher.addSelectables(notSelectors, null);\n    return notMatcher;\n  }\n\n  private _elementMap = new Map<string, SelectorContext<T>[]>();\n  private _elementPartialMap = new Map<string, SelectorMatcher<T>>();\n  private _classMap = new Map<string, SelectorContext<T>[]>();\n  private _classPartialMap = new Map<string, SelectorMatcher<T>>();\n  private _attrValueMap = new Map<string, Map<string, SelectorContext<T>[]>>();\n  private _attrValuePartialMap = new Map<string, Map<string, SelectorMatcher<T>>>();\n  private _listContexts: SelectorListContext[] = [];\n\n  addSelectables(cssSelectors: CssSelector[], callbackCtxt?: T) {\n    let listContext: SelectorListContext = null!;\n    if (cssSelectors.length > 1) {\n      listContext = new SelectorListContext(cssSelectors);\n      this._listContexts.push(listContext);\n    }\n    for (let i = 0; i < cssSelectors.length; i++) {\n      this._addSelectable(cssSelectors[i], callbackCtxt as T, listContext);\n    }\n  }\n\n  /**\n   * Add an object that can be found later on by calling `match`.\n   * @param cssSelector A css selector\n   * @param callbackCtxt An opaque object that will be given to the callback of the `match` function\n   */\n  private _addSelectable(\n    cssSelector: CssSelector,\n    callbackCtxt: T,\n    listContext: SelectorListContext,\n  ) {\n    let matcher: SelectorMatcher<T> = this;\n    const element = cssSelector.element;\n    const classNames = cssSelector.classNames;\n    const attrs = cssSelector.attrs;\n    const selectable = new SelectorContext(cssSelector, callbackCtxt, listContext);\n\n    if (element) {\n      const isTerminal = attrs.length === 0 && classNames.length === 0;\n      if (isTerminal) {\n        this._addTerminal(matcher._elementMap, element, selectable);\n      } else {\n        matcher = this._addPartial(matcher._elementPartialMap, element);\n      }\n    }\n\n    if (classNames) {\n      for (let i = 0; i < classNames.length; i++) {\n        const isTerminal = attrs.length === 0 && i === classNames.length - 1;\n        const className = classNames[i];\n        if (isTerminal) {\n          this._addTerminal(matcher._classMap, className, selectable);\n        } else {\n          matcher = this._addPartial(matcher._classPartialMap, className);\n        }\n      }\n    }\n\n    if (attrs) {\n      for (let i = 0; i < attrs.length; i += 2) {\n        const isTerminal = i === attrs.length - 2;\n       